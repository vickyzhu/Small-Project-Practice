(function(a){a(function(){l.init()});var l={addOrEditContact:function(){var g=a("body"),b=a("#ContactForm"),h=a(".drop-area"),f=a(".drop-for-person"),c=a(".drop-for-company");$concern=a(".concern-area");$personConcern=a("#person-concern");$personConcern.on("click",".load-more",function(){a(this).addClass("expanding");f.slideDown()});f.on("click",".collapse-drop",function(){var c=a(".drop-for-person .area-list .active");if(c)for(var b=0;b<c.length;b++)a(".expanding").parent(".area-list").append(c[b]);a(".expanding").parent(".area-list").append('\x3cli class\x3d"load-more"\x3e\x3ca href\x3d"javascript:void(0);"\x3e\u66f4\u591a\x26gt;\x26gt;\x3c/a\x3e\x3c/li\x3e');a(".expanding").remove();f.fadeOut()});$companyConcern=a("#company-concern");$companyConcern.on("click",".load-more",function(){a(this).addClass("expanding");c.slideDown()});c.on("click",".collapse-drop",function(){var b=a(".drop-for-company .area-list .active");if(b)for(var k=0;k<b.length;k++)a(".expanding").parent(".area-list").append(b[k]);a(".expanding").parent(".area-list").append('\x3cli class\x3d"load-more"\x3e\x3ca href\x3d"javascript:void(0);"\x3e\u66f4\u591a\x26gt;\x26gt;\x3c/a\x3e\x3c/li\x3e');a(".expanding").remove();c.fadeOut()});h.on("click",".add-more",function(){baseEvn.popFun({mainClass:"pop-area",Content:'\x3cdiv class\x3d"add-area"\x3e\x3clabel for\x3d"areaName"\x3e\x3cp\x3e\u9886\u57df\x3cspan\x3e*\x3c/span\x3e\x3c/p\x3e\x3cinput type\x3d"text" name\x3d"areaName" id\x3d"areaName" data-null\x3d"\u8bf7\u8f93\u5165\u9886\u57df\u5206\u7c7b"\x3e\x3c/label\x3e\x3cdiv class\x3d"user-operate-part"\x3e\x3ca href\x3d"javascript:void(0)" class\x3d"btn sure-btn"\x3e\u786e\u5b9a\x3c/a\x3e\x3ca href\x3d"javascript:void(0)" class\x3d"btn cancell-btn"\x3e\u53d6\u6d88\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e'})});g.on("click",".add-area .sure-btn",function(){var b=a(".add-area #areaName").val();baseEvn.validate(a(".add-area #areaName"))&&baseEvn.postData({params:{url:baseEvn.dataApi.addConcernArea,name:b},okCallBack:function(a){baseEvn.popFun2({Content:"\u6dfb\u52a0\u9886\u57df\u6210\u529f"})},errCallBack:function(a){baseEvn.popFun({Content:msg})}});return!1});webUploaderEvn.init({wrap:b.find(".user-related-info"),pick:{id:b.find(".user-related-info .filePicker"),innerHTML:"\u4e0a\u4f20\u540d\u7247"},auto:!0,server:baseEvn.dataApi.doUploadImage,progressCallBack:function(a,b){},successCallBack:function(a,b){console.log(a,b)}});b.on("click",".save-btn",function(){var c=a(this),f=0,e={url:baseEvn.dataApi.addContact,name:b.find("#name"),phone:b.find("#phone"),company:b.find("#company"),position:b.find("#position"),email:b.find("#email"),tel:b.find("#tel"),address:b.find("#address"),image:"",person_area:[],company_area:[]};if(c.hasClass("posting"))return!1;b.find("#person-concern .active").each(function(){e.person_area.push(c.data("id"))});b.find("#company-concern .active").each(function(){e.company_area.push(c.data("id"))});for(var d in e)"url"!=d&&"person_area"!=d&&"company_area"!=d&&"image"!=d&&("company"==d||"position"==d||"email"==d||"tel"==d||"address"==d?""!=e[d].val()?baseEvn.validate(e[d])?e[d]=e[d].val():f++:e[d]=e[d].val():baseEvn.validate(e[d])?e[d]=e[d].val():f++);console.log("errNum:"+f);0==f?(c.addClass("posting").html("\u63d0\u4ea4\u4e2d\u3002\u3002"),"edit"==c.data("type")&&(e.url==baseEvn.dataApi.editContact,""==e.id),baseEvn.postData({params:e,okCallBack:function(a){baseEvn.popFun2({Content:"\u4fdd\u5b58\u6210\u529f\uff01"});c.removeClass("posting").html("\u4fdd\u5b58")},errCallBack:function(a){baseEvn.popFun({Content:a.msg});c.removeClass("posting").html("\u4fdd\u5b58")}})):(baseEvn.popFun({Content:"\u4fe1\u606f\u672a\u5b8c\u5168\u586b\u5199\u6b63\u786e\uff0c\u8bf7\u68c0\u67e5\uff01"}),a("html,body").stop().animate({scrollTop:b.offset().top},1200),c.removeClass("posting").html("\u4fdd\u5b58"));return!1});b.on("click",".cancell-btn",function(){a(this).data("id")&&baseEvn.postData({params:{url:baseEvn.dataApi.getLastSaveInfo,_id:""},okCallBack:function(a){},errCallBack:function(a){baseEvn.popFun({Content:a.msg})}})});b.on("click",".unbind-weixin",function(){baseEvn.popFun({mainClass:"pop-confirm",Content:'\x3cdiv class\x3d"confirm-con"\x3e\x3cp\x3e\u786e\u5b9a\u89e3\u7ed1\u8be5\u8054\u7cfb\u4eba\u5fae\u4fe1\uff1f\x3c/p\x3e\x3cdiv class\x3d"user-operate-part"\x3e\x3ca href\x3d"javascript:void(0)" class\x3d"btn sure-btn unblind"\x3e\u786e\u5b9a\x3c/a\x3e\x3ca href\x3d"javascript:void(0)" class\x3d"btn cancell-btn"\x3e\u53d6\u6d88\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e'})});b.on("click",".pop-confirm .unblind",function(){baseEvn.postData({params:{url:baseEvn.dataApi.unbindWeixin},okCallBack:function(a){b.find(".weixin-box").html('\x3ca href\x3d"bind-weixin.html" class\x3d"bind-weixin"\x3e\u70b9\u51fb\u7ed1\u5b9a\u5fae\u4fe1\x3c/a\x3e')},errCallBack:function(a){baseEvn.popFun({Content:a.msg})}})});g.on("click","#sortArea",function(){a(".area-sort").show();a(".concern-area").hide()})},allContacts:function(){var g=a(".all-contacts");g.on("click",".area-choice li",function(){if(!a(this).hasClass("load-more")){a(this).addClass("active").siblings().removeClass("active");a(".drop-area li").removeClass("active");var b=a(this).data("id");baseEvn.postData({params:{url:baseEvn.dataApi.contactsInArea,_id:b},okCallBack:function(b){var c=[];for(i in b)c.push("\x3cli\x3e"),c.push('\t\x3ca href\x3d"contact-detail.html" class\x3d"clearfix"\x3e'),c.push('\t\t\x3cdiv class\x3d"left"\x3e\x3cimg src\x3d"../../wassets/images/contact-phpto.png"\x3e\x3c/div\x3e'),c.push('\t\t\x3cdiv class\x3d"right"\x3e'),c.push("\t\t\t\x3ch2\x3e\u97e9\u7389\x3c/h2\x3e"),c.push('\t\t\t\x3cdiv class\x3d"contact-phone"\x3e13800138000\x3c/div\x3e'),c.push('\t\t\t\x3cdiv class\x3d"contact-company"\x3e\u6df1\u5733\u53ef\u8d2d\u767e\u6280\u672f\u6709\u9650\u516c\u53f8\x3c/div\x3e'),c.push("\t\t\x3c/div\x3e"),c.push("\t\x3c/a\x3e"),c.push("\x3c/li\x3e");a(".related-contacts").html(c.join(""))},errCallBack:function(a){baseEvn.popFun({Content:a.msg})}})}});var b=a(".drop-area");a("#expandArea").on("click",function(){b.slideDown(500);b.find(".area-choice li").on("click",function(){g.find(".area-choice li").removeClass("active");a(this).addClass("active").siblings().removeClass("active");var h=a(this).data("id");b.fadeOut();baseEvn.postData({params:{url:baseEvn.dataApi.contactsInArea,_id:h},okCallBack:function(b){var c=[];for(i in b)c.push("\x3cli\x3e"),c.push('\t\x3ca href\x3d"contact-detail.html" class\x3d"clearfix"\x3e'),c.push('\t\t\x3cdiv class\x3d"left"\x3e\x3cimg src\x3d"../../wassets/images/contact-phpto.png"\x3e\x3c/div\x3e'),c.push('\t\t\x3cdiv class\x3d"right"\x3e'),c.push("\t\t\t\x3ch2\x3e\u97e9\u7389\x3c/h2\x3e"),c.push('\t\t\t\x3cdiv class\x3d"contact-phone"\x3e13800138000\x3c/div\x3e'),c.push('\t\t\t\x3cdiv class\x3d"contact-company"\x3e\u6df1\u5733\u53ef\u8d2d\u767e\u6280\u672f\u6709\u9650\u516c\u53f8\x3c/div\x3e'),c.push("\t\t\x3c/div\x3e"),c.push("\t\x3c/a\x3e"),c.push("\x3c/li\x3e");a(".related-contacts").html(c.join(""))},errCallBack:function(a){baseEvn.popFun({Content:a.msg})}})})});b.on("click","#collapseDrop",function(){b.fadeOut()})},bindWeixin:function(){a(".contact-list").on("click",".list-item label",function(){a(".contact-list").find(".icon").removeClass("active");a(this).find(".icon").toggleClass("active");baseEvn.postData({params:{},okCallBack:function(a){window.location.href=""},errCallBack:function(a){baseEvn.postFun({Content:a.msg})}});return!1})},init:function(){0<a("#ContactForm").length&&this.addOrEditContact();0<a("#allContacts").length&&this.allContacts();0<a("#bindWeixin").length&&this.bindWeixin();var g=a(".area-list");if(0>=a(".contactDetail").length)g.on("click","li",function(){a(this).hasClass("load-more")||a(this).hasClass("add-more")||a(this).toggleClass("active")})}}})(jQuery);