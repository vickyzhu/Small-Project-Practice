(function(){$(function(){g.init()});var g={popFun:function(b){var c=0<$("#pop").length?!0:!1,a=null,d=[];b=$.extend({Content:"",mainClass:"",Tips:"",headContent:"",isOffMaskFun:!1,callback:function(){}},b);d.push('\t\t\x3cdiv class\x3d"pop-content"\x3e'+b.Content+"\x3c/div\x3e");c?$("#pop .pop-main").attr("class","pop-main "+b.mainClass).html(d.join("")).parent().fadeIn():(a=$('\x3cdiv class\x3d"pop" id\x3d"pop"\x3e\x3cdiv class\x3d"pop-mask"\x3e\x3c/div\x3e\x3cdiv class\x3d"pop-main '+b.mainClass+'"\x3e\x3c/div\x3e\x3c/div\x3e'),a.find(".pop-main").append(d.join("")),$("body").append(a).find(".pop").fadeIn(),a.on("click",".pop-btn-close,.pop-mask,.cancell-btn",function(){a.fadeOut()}));"function"==typeof b.callback&&b.callback(a||$("#pop"))},popFun2:function(b){var c=0<$("#pop").length?!0:!1,a=null,d=[];b=$.extend({Content:"",mainClass:"",isOffMaskFun:!1,callback:function(){}},b);d.push("      \x3cdiv \x3e"+b.Content+"\x3c/div\x3e");c?$("#pop .pop-main").attr("class","pop-main "+b.mainClass).html(d.join("")).parent().fadeIn():(a=$('\x3cdiv class\x3d"pop" id\x3d"pop"\x3e\x3cdiv class\x3d"pop-mask2"\x3e\x3c/div\x3e\x3cdiv class\x3d"pop-main '+b.mainClass+'"\x3e\x3c/div\x3e\x3c/div\x3e'),a.find(".pop-main").append(d.join("")),$("body").append(a).find(".pop").fadeIn());"function"==typeof b.callback&&b.callback(a||$("#pop"))},validate:function(b){var c=b.attr("name"),a=$.trim(b.val()),d=0,h=a.length;if(""==a)return b.val(""),g.validationTxtTips(b,0),!1;if(0<=$.inArray(c,["name","company","position","address"])&&g.validateRex.specialChar.test(a)||0<=$.inArray(c,["phone","tel"])&&g.validateRex.numChar.test(a)||0<=$.inArray(c,["email"])&&g.validateRex.emailSpecialChar.test(a))return g.validationTxtTips(b,1),!1;switch(c){case "name":d=1<=h&&68>=h?d:d+1;break;case "company":case "position":d=0<=h&&68>=h?d:d+1;break;case "address":d=0<=h&&200>=h?d:d+1;break;case "phone":case "tel":d=g.validateRex.integer.test(a)?d:d+1;break;case "email":d=g.validateRex.email.test(a)?d:d+1;break;case "area_name":d=1<=h&&68>=h?d:d+1}if(0<d)return g.validationTxtTips(b,2),!1;g.validationTxtTips(b,-1);return!0},validationTxtTips:function(b,c){var a="";switch(c){case 0:a=b.attr("data-null")||"\u4e0d\u80fd\u4e3a\u7a7a";break;case 1:a=b.attr("data-specialChar")||"\u60a8\u7684\u8f93\u5165\u542b\u6709\u7279\u6b8a\u5b57\u7b26";break;case 2:a=b.attr("data-formatErr")||"\u60a8\u7684\u8f93\u5165\u683c\u5f0f\u6709\u8bef";break;case 3:a=b.attr("data-rePasswordErr")||"\u4e24\u6b21\u8f93\u5165\u7684\u5bc6\u7801\u4e0d\u4e00\u81f4";break;default:a=b.attr("data-through")||"\x26nbsp;"}0<=c?(b.addClass("in-err").removeClass("in-ok"),alert(a)):b.addClass("in-ok").removeClass("in-err")},postData:function(b){$.post(b.params.url?b.params.url:"/",b.params,function(c){"ok"==c.status?$.isFunction(b.okCallBack)&&b.okCallBack(c):$.isFunction(b.errCallBack)&&b.errCallBack(c)},"json")},publicEvn:function(){var b=$(".search-part"),c=b.find(".default-state"),a=b.find(".enter-state"),d=a.find(".clear-icon"),b=a.find("#cancellBtn");c.on("click",function(){$(this).hide();a.show().find("input").focus()});d.on("click",function(){a.find("#searchKey").val("").focus();$(this).hide()});b.on("click",function(){a.hide();c.show()});a.find("#searchKey").bind("input propertychange",function(){console.log("searchKey:"+$(this).val());""!=$(this).val()?d.show():d.hide();var b=a.find("#searchKey").val();g.postData({params:{url:g.dataApi.searchContact,searchKey:b},okCallBack:function(b){var a=[],d=0;Data=b.data;if(0<$("#allContacts").length){for(d in b)a.push("\x3cli\x3e"),a.push('\t\x3ca href\x3d"contact-detail.html"\x3e'),a.push('\t\t\x3cdiv class\x3d"left"\x3e\x3cimg src\x3d"../../wassets/images/contact-phpto.png"\x3e\x3c/div\x3e'),a.push('\t\t\x3cdiv class\x3d"right"\x3e'),a.push("\t\t\t\x3ch2\x3e\u97e9\u7389\x3c/h2\x3e"),a.push('\t\t\t\x3cdiv class\x3d"contact-phone"\x3e13800138000\x3c/div\x3e'),a.push('\t\t\t\x3cdiv class\x3d"contact-company"\x3e\u6df1\u5733\u53ef\u8d2d\u767e\u6280\u672f\u6709\u9650\u516c\u53f8\x3c/div\x3e'),a.push("\t\t\x3c/div\x3e"),a.push("\t\x3c/a\x3e"),a.push("\x3cli\x3e");$(".contacts-search-result").show();$(".related-contacts ul").html(a.join(""))}else if(0<$("#bindWeixin").length){for(d in b)a.push('\x3cli class\x3d"list-item"\x3e'),a.push('\t\x3clabel for\x3d"1"\x3e'),a.push('\t\t\x3cdiv class\x3d"contact-info"\x3e'),a.push('\t\t\t\x3cdiv class\x3d"contact-head"\x3e\x3cimg src\x3d"../../wassets/images/user-head.png"\x3e\x3c/div\x3e'),a.push('\t\t\t\x3cp class\x3d"contact-name"\x3eshellalia\x3c/p\x3e'),a.push("\t\t\x3c/div\x3e"),a.push('\t\t\x3cinput type\x3d"checkbox" id\x3d"2" class\x3d"icon"\x3e'),a.push("\t\x3c/label\x3e"),a.push("\x3cli\x3e");$(".recent-concern-contacts").show();$(".contact-list").html(a.join(""))}},errCallBack:function(){g.popFun({Content:backData.msg})}});return!1})},init:function(){this.RES_URL="undefined"==typeof resourceUrl?"http://nres.ingdan.com/":resourceUrl;this.validateRex={integer:/^[1-9]\d*$/,integer2:/^[0-9]\d*$/,integer3:/^(?!0)(?:[0-9]{1,3}|1000)$/,num:/^\d+(\.\d+)?$/,email:/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/,nickname:/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/,password:/^\w{6,16}$/,tel:/^(\(\d{3,4}\)|\d{3,4}-)?\d{7,8}$/,phone:/^[1]\d{10}$/,emailSpecialChar:/[`~!#$%^&*+<>{}\/'[\]]/im,numChar:/[`~!@#$%^&*-+<>{}\/'[\]]/im,specialChar:/[`~!@#$%^&*-+.<>{}\/'[\]]/im,url:/^(https?|ftp|mms):\/\/([A-z0-9_\-]+\.)*[A-z0-9]+\-?[A-z0-9]+\.[A-z]{2,}(\/.*)*\/?/};this.dataApi={doUploadImage:"/commonapi/do_upload_image",addContact:"",getLastSaveInfo:"",editContact:"",searchContact:"",contactsInArea:"",addConcernArea:"",unbindWeixin:""};this.publicEvn()}};window.baseEvn=g;window.webUploaderEvn={init:function(b){function c(e){var a=$('\x3cli id\x3d"'+e.id+'"\x3e\x3cp class\x3d"title"\x3e'+e.name+'\x3c/p\x3e\x3cp class\x3d"imgWrap"\x3e\x3c/p\x3e\x3cp class\x3d"progress"\x3e\x3cspan\x3e\x3c/span\x3e\x3c/p\x3e\x3c/li\x3e'),b=$('\x3cdiv class\x3d"file-panel"\x3e\x3cspan class\x3d"cancel"\x3e\u5220\u9664\x3c/span\x3e\x3c/div\x3e').appendTo(a),d=a.find("p.progress span"),c=a.find("p.imgWrap"),g=$('\x3cp class\x3d"error"\x3e\x3c/p\x3e'),h=function(e){switch(e){case "exceed_size":text="\u6587\u4ef6\u5927\u5c0f\u8d85\u51fa";break;case "interrupt":text="\u4e0a\u4f20\u6682\u505c";break;default:text="\u4e0a\u4f20\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5"}g.text(text).appendTo(a)};"invalid"===e.getStatus()?h(e.statusText):(c.text("\u9884\u89c8\u4e2d"),f.makeThumb(e,function(e,a){var b;e?c.text("\u4e0d\u80fd\u9884\u89c8"):z?(b=$('\x3cimg src\x3d"'+a+'"\x3e'),c.empty().append(b)):$.ajax(k.previewServer,{method:"POST",data:a,dataType:"json"}).done(function(e){e.result?(b=$('\x3cimg src\x3d"'+e.result+'"\x3e'),c.empty().append(b)):c.text("\u9884\u89c8\u51fa\u9519")})},A,B),p[e.id]=[e.size,0],e.rotation=0);e.on("statuschange",function(c,f){"progress"===f?d.hide().width(0):"queued"===f&&(a.off("mouseenter mouseleave"),b.remove());"error"===c||"invalid"===c?(h(e.statusText),p[e.id][1]=1):"interrupt"===c?h("interrupt"):"queued"===c?p[e.id][1]=0:"progress"===c?(g.remove(),d.css("display","block")):"complete"===c&&a.append('\x3cspan class\x3d"success"\x3e\x3c/span\x3e');a.removeClass("state-"+f).addClass("state-"+c)});a.on("mouseenter",function(){b.stop().animate({height:30})});a.on("mouseleave",function(){b.stop().animate({height:0})});b.on("click","span",function(){var a;switch($(this).index()){case 0:f.removeFile(e);return;case 1:e.rotation+=90;break;case 2:e.rotation-=90}C?(a="rotate("+e.rotation+"deg)",c.css({"-webkit-transform":a,"-mos-transform":a,"-o-transform":a,transform:a})):c.css("filter","progid:DXImageTransform.Microsoft.BasicImage(rotation\x3d"+~~(e.rotation/90%4+4)%4+")")});a.prependTo(w)}function a(){var e=0,a=0,b=u.children(),c;$.each(p,function(b,c){a+=c[0];e+=c[0]*c[1]});c=a?e/a:0;b.eq(0).text(Math.round(100*c)+"%");b.eq(1).css("width",Math.round(100*c)+"%");d()}function d(){var a="",b;"ready"===l?a="\u9009\u4e2d"+q+"\u5f20\u56fe\u7247\uff0c\u5171"+WebUploader.formatSize(r)+"\u3002":"confirm"===l?(b=f.getStats(),b.uploadFailNum&&(a="\u5df2\u6210\u529f\u4e0a\u4f20"+b.successNum+"\u5f20\u56fe\u7247\uff0c"+b.uploadFailNum+'\u5f20\u56fe\u7247\u4e0a\u4f20\u5931\u8d25\uff0c\x3ca class\x3d"retry" href\x3d"javascript:void(0);"\x3e\u91cd\u65b0\u4e0a\u4f20\x3c/a\x3e\u5931\u8d25\u56fe\u7247\u6216\x3ca class\x3d"ignore" href\x3d"javascript:void(0);"\x3e\u5ffd\u7565\x3c/a\x3e')):(b=f.getStats(),a="\u5171"+q+"\u5f20\uff08"+WebUploader.formatSize(r)+"\uff09\uff0c\u5df2\u4e0a\u4f20"+b.successNum+"\u5f20",b.uploadFailNum&&(a+="\uff0c\u5931\u8d25"+b.uploadFailNum+"\u5f20"));x.html(a)}function h(a){if(a!==l){n.removeClass("state-"+l);n.addClass("state-"+a);l=a;switch(l){case "pedding":y.removeClass("element-invisible");w.hide();t.addClass("element-invisible");f.refresh();break;case "ready":y.addClass("element-invisible");$(k.pickAdd.id).removeClass("element-invisible");w.show();t.removeClass("element-invisible");f.refresh();break;case "uploading":$(k.pickAdd.id).addClass("element-invisible");u.show();n.text("\u6682\u505c\u4e0a\u4f20");break;case "paused":u.show();n.text("\u7ee7\u7eed\u4e0a\u4f20");break;case "confirm":u.hide();$(k.pickAdd.id).removeClass("element-invisible");n.text("\u5f00\u59cb\u4e0a\u4f20");a=f.getStats();if(a.successNum&&!a.uploadFailNum){h("finish");return}break;case "finish":a=f.getStats(),a.successNum||(l="done",location.reload())}d()}}var m=b.wrap,w=m.find(".filelist"),t=m.find(".statusBar"),x=t.find(".info"),n=m.find(".uploadBtn"),y=m.find(".placeholder"),u=t.find(".progress").hide(),q=0,r=0,v=window.devicePixelRatio||1,A=110*v,B=110*v,l="pedding",p={},z=function(){var a=new Image,b=!0;a.onload=a.onerror=function(){if(1!=this.width||1!=this.height)b=!1};a.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw\x3d\x3d";return b}(),v=function(){var a;try{a=navigator.plugins["Shockwave Flash"],a=a.description}catch(b){try{a=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(c){a="0.0"}}a=a.match(/\d+/g);return parseFloat(a[0]+"."+a[1],10)}(),C=function(){var a=document.createElement("p").style;return"transition"in a||"WebkitTransition"in a||"MozTransition"in a||"msTransition"in a||"OTransition"in a}(),f,D={pick:{id:m.find(".filePicker"),innerHTML:"\u70b9\u51fb\u9009\u62e9\u56fe\u7247"},pickAdd:{id:m.find(".filePicker2"),innerHTML:"\u7ee7\u7eed\u6dfb\u52a0"},accept:{extensions:"gif,jpg,jpeg,png"},formData:{uid:123},swf:g.RES_URL+"bassets/plug/webuploader/Uploader.swf",chunked:!1,chunkSize:524288,server:"/commonapi/do_upload_image",previewServer:g.RES_URL+"bassets/plug/webuploader/server/preview.php",disableGlobalDnd:!0,fileNumLimit:300,fileSizeLimit:209715200,fileSingleSizeLimit:12582912,successCallBack:function(){},progressCallBack:function(){}},k=$.extend(D,b);!WebUploader.Uploader.support("flash")&&WebUploader.browser.ie?v?function(a){window.expressinstallcallback=function(a){switch(a){case "Download.Cancelled":alert("\u60a8\u53d6\u6d88\u4e86\u66f4\u65b0\uff01");break;case "Download.Failed":alert("\u5b89\u88c5\u5931\u8d25");break;default:alert("\u5b89\u88c5\u5df2\u6210\u529f\uff0c\u8bf7\u5237\u65b0\uff01")}delete window.expressinstallcallback};var b='\x3cobject type\x3d"application/x-shockwave-flash" data\x3d"./expressInstall.swf" ';WebUploader.browser.ie&&(b+='classid\x3d"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ');a.html(b+'width\x3d"100%" height\x3d"100%" style\x3d"outline:0"\x3e\x3cparam name\x3d"movie" value\x3d"./expressInstall.swf" /\x3e\x3cparam name\x3d"wmode" value\x3d"transparent" /\x3e\x3cparam name\x3d"allowscriptaccess" value\x3d"always" /\x3e\x3c/object\x3e')}(m):m.html('\x3ca href\x3d"http://www.adobe.com/go/getflashplayer" target\x3d"_blank" border\x3d"0"\x3e\x3cimg alt\x3d"get flash player" src\x3d"http://www.adobe.com/macromedia/style_guide/images/160x41_Get_Flash_Player.jpg" /\x3e\x3c/a\x3e'):WebUploader.Uploader.support()?(f=WebUploader.create(k),f.on("dndAccept",function(a){for(var b=!1,c=a.length,d=0;d<c;d++)if(~"text/plain;application/javascript ".indexOf(a[d].type)){b=!0;break}return!b}),f.on("dialogOpen",function(){}),k.pickAdd&&f.addButton(k.pickAdd),f.on("ready",function(){}),f.on("uploadProgress",function(b,c){$("#"+b.id).find(".progress span").css("width",100*c+"%");p[b.id][1]=c;a();"function"==typeof k.progressCallBack&&k.progressCallBack(b,c)}),f.on("fileQueued",function(b){q++;r+=b.size;1===q&&(y.addClass("element-invisible"),t.show());c(b);h("ready");a()}),f.on("fileDequeued",function(b){q--;r-=b.size;q||h("pedding");var c=$("#"+b.id);delete p[b.id];a();c.off().find(".file-panel").off().end().remove();a()}),f.on("all",function(a,b,c){switch(a){case "uploadFinished":h("confirm");break;case "startUpload":h("uploading");break;case "stopUpload":h("paused");break;case "uploadSuccess":h("confirm"),"function"==typeof k.successCallBack&&k.successCallBack(b,c)}}),f.on("error",function(a){var b="\u672a\u77e5\u9519\u8bef\uff0c\u8bf7\u8054\u7cfb\u6211\u4eec\u6216\u63d0\u4ea4\u53cd\u9988\u610f\u89c1\uff01";switch(a){case "Q_EXCEED_NUM_LIMIT":b="\u4f60\u53ea\u80fd\u4e0a\u4f20"+k.fileNumLimit+"\u4e2a\u6587\u4ef6\u54e6\uff01";break;case "Q_EXCEED_SIZE_LIMIT":b="\u4f60\u4e0a\u4f20\u6587\u4ef6\u603b\u5927\u5c0f\u8d85\u8fc7\u4e86"+Math.ceil(k.fileSizeLimit/1024)+"KB\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\uff01";break;case "F_EXCEED_SIZE":b="\u4f60\u4e0a\u4f20\u7684\u6587\u4ef6\u4e2d\uff0c\u6709\u8d85\u8fc7\u4e86"+Math.ceil(k.fileSingleSizeLimit/1024/1024)+"M\u7684\u6587\u4ef6\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\uff01";break;case "Q_TYPE_DENIED":b="\u4f60\u4e0a\u4f20\u7684\u6587\u4ef6\u4e2d\uff0c\u6709\u4e0d\u7b26\u5408"+k.accept.extensions+"\u683c\u5f0f\u7684\u6587\u4ef6\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\uff01";break;case "F_DUPLICATE":b="\u4e0d\u80fd\u4e0a\u4f20\u540c\u4e00\u5f20\u56fe\u7247\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\uff01"}g.popFun({Content:'\x3cp class\x3d"state-tip"\x3e'+b+"\x3c/p\x3e"})}),n.on("click",function(){if($(this).hasClass("disabled"))return!1;"ready"===l?f.upload():"paused"===l?f.upload():"uploading"===l&&f.stop()}),x.on("click",".retry",function(){f.retry()}),x.on("click",".ignore",function(){}),n.addClass("state-"+l),a()):alert("Web Uploader \u4e0d\u652f\u6301\u60a8\u7684\u6d4f\u89c8\u5668\uff01")}}})();